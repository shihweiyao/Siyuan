<div class="container-fluid">
	<div class="row">
		<div class="col-lg-12">		
		<div class="donation_year text-center"><span><%= Time.zone.now.year-1 %>年</span><span style="margin-left: 18px; margin-right: 18px;">|</span><span><%= Time.zone.now.year%>年</span></div>	
		<div class="donation_summary text-center">
			<div class="donation_summary_inner">
				<div class="donation_summary_number"></div> <div class="donation_summary_en">NTW</div>	
			</div>
			<div class="donation_range text-right">累積期間 2016/01/01~2016/04/13</div>	
		</div>
		</div>
	</div>	
</div>	
<div class="container-fluid donation_content_donate">
	<div class="donation_content_background_image"></div>
	<div class="row" style="position:relative; z-index:2;">
		<div class="col-lg-offset-4 col-lg-4 col-sm-offset-2 col-sm-8 donation_content_donate_inner">
			<p class="text-center" style="font-size: 22px; letter-spacing: 2px; color: #898989;">贊助不指定計畫</p>		
			<%= form_tag('/main/donation', class: "donation_form") do -%>
						<%= hidden_field_tag 'id', 1, class: 'form-control'%>
						<div class="donation_form_title">收據</div> 
						<div class="btn-group donation_btn_group" data-toggle="buttons">
			                <label class="btn btn-default donation_gray_btn">
			                    <input type="radio" name="receipt" autocomplete="off" value="true" id="1" /> 是                
			                </label> 
			                <label class="btn btn-default donation_gray_btn">
			                    <input type="radio" name="receipt" autocomplete="off" value="false" id="1" /> 否	                
			                </label>   
			            </div>	
			            <div class="form_group_donation form_group_donation_hidden form_group_donation_1">						            				
							<div class="form-group">
								<div class="donation_form_title">收據抬頭</div> 
							  	<%= text_field_tag 'title', nil, class: 'form-control' %>
							</div>
						    <div class="form-group">
						    	<div class="donation_form_title">電話</div>   
						  		<%= text_field_tag 'phone', nil, class: 'form-control' %>
						    </div>  
						    <div class="form-group">
						    	<div class="donation_form_title">地址</div>   
						  		<%= text_field_tag 'address', nil, class: 'form-control' %>
						  	</div>  
						</div>						  					  	 
					  	<div class="donation_form_title">金額</div>  
						<div class="btn-group donation_btn_group" data-toggle="buttons">
			                <label class="btn btn-default donation_gray_btn">
			                    <input type="radio" name="amount" autocomplete="off" value="1000" /> $1000	                
			                </label> 
			                <label class="btn btn-default donation_gray_btn">
			                    <input type="radio" name="amount" autocomplete="off" value="2000" /> $2000	                
			                </label> 
			                <label class="btn btn-default donation_gray_btn">
			                    <input type="radio" name="amount" autocomplete="off" value="5000" /> $5000	                
			                </label> 			    
			                <label class="btn btn-default donation_gray_btn">
			                    <input type="radio" name="amount" autocomplete="off" value="10000" /> $10000	                
			                </label> 		
			                <label class="btn btn-default donation_gray_btn">
			                    <input type="radio" name="amount" autocomplete="off" value="15000" /> $15000	                
			                </label> 
			                <label class="btn btn-default donation_gray_btn">
			                    <input type="radio" name="amount" autocomplete="off" value="20000" /> $20000	                
			                </label> 			                			                		                            			                
		           		</div>    
						<div class="form-group form-inline"> 
						  	<%= text_field_tag 'amount_others', nil, class: 'form-control amount_others', placeholder: '或輸入您想捐款的金額'%>
							<%= submit_tag '捐款', class: "btn donation_button" %>
						</div>  
			<% end -%>	
		</div>
	</div>	
</div>	
<div class="grid">
	<% Project.where('id <> 1').all.each do |project|%>
		<%=render "donation_card", project: project%>	
	<% end %>	 	
</div>	
<div class="container-fluid">
	<div class="row" style="margin-bottom: 40px; margin-top: 40px;">
		<div class="col-lg-offset-3 col-lg-6 text-center">	
		<button type="button" class="btn btn-block donation_project_button" data-toggle="modal" data-target="#myModal">查詢委辦計畫</button>
		</div>
	</div>		
</div>	

<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-lg">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">查詢委辦計畫</h4>
      </div>
      <div class="modal-body">        
		<form class="form-inline" id="login_form">
		  <div class="form-group">
		    <label for="project_account">計畫帳號</label>
		    <input type="text" class="form-control" id="project_account" name="project_account">
		  </div>
		  <div class="form-group">
		    <label for="project_password">計畫密碼</label>
		    <input type="password" class="form-control" id="project_password" name="project_password">
		  </div>
		  <button type="submit" class="btn btn-default">查詢</button>
		</form>              
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default " data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>






<script>

//============================= count =============================//

var controller = new ScrollMagic.Controller();
$('.donation_summary_number').html( Math.ceil(2888321-10000).toLocaleString() )
var foo = { bar: 2888321-10000 };		
tween = new TimelineLite();
tween.to(foo, 2, { bar: 2888321, onUpdate: function() {
	 $('.donation_summary_number').html(Math.ceil(foo.bar).toLocaleString());}, ease: Linear.easeNone})
	 .to(".donation_summary_en", 1, {autoAlpha: 1, ease: Linear.easeNone})
	 //.to(".donation_year", 1, {autoAlpha: 1, ease: Linear.easeNone})
	 .to(".donation_range", 1, {autoAlpha: 1, ease: Linear.easeNone})
	 .to(".donation_content_donate_inner", 1, {autoAlpha: 1, ease: Linear.easeNone})
	 .from(".donation_content_donate_inner", 1,{bottom: "40px", ease: Linear.easeNone})
/*
new ScrollMagic.Scene({triggerElement: ".menu"})
	.setTween(tween)
	.addTo(controller) 
*/
//============================= masonry =============================//
var $grid = $('.grid').masonry({
  columnWidth: '.grid-item',
  itemSelector: '.grid-item',
  percentPosition: true
  //gutter: '.gutter-sizer',    
});
$grid.on( 'click', '.grid-item-button', function( event ) {
  $( event.currentTarget ).closest('.grid-item').toggleClass('is-expanded');
  $grid.masonry();
  
  $("#doughnutChart_"+event.currentTarget.id).drawDoughnutChart([
    { title: "人事", value: parseInt($('#doughnutChart_'+event.currentTarget.id).attr('data-exp_personnel')),  color: "#02a0eb" },
    { title: "雜支", value: parseInt($('#doughnutChart_'+event.currentTarget.id).attr('data-exp_business')),   color: "#c070a3" },
    { title: "業務", value: parseInt($('#doughnutChart_'+event.currentTarget.id).attr('data-exp_mix')),   color: "#f4a301" },
    { title: "其他", value: parseInt($('#doughnutChart_'+event.currentTarget.id).attr('data-exp_other')),   color: "#b3a253" }
  ], {tipClass: "doughnutTip "+"doughnutTip_"+event.currentTarget.id});  
  
});

$grid.on( 'click', '.grid-item-close', function( event ) {
  $( event.currentTarget ).closest('.grid-item').toggleClass('is-expanded');
  $grid.masonry();
  $("#doughnutChart_"+event.currentTarget.id).empty();
  $(".doughnutTip_"+event.currentTarget.id).remove();
});
//============================= radio =============================//
$('input[type=radio][name=receipt]').change(function() {
    $('.form_group_donation_'+this.id).toggleClass('form_group_donation_hidden');             	    
    $grid.masonry() 
});
//============================= sponsor =============================//
$grid.on( 'click', '.donation_sponsor .glyphicon', function( event ) {
	$('.donation_sponsor_content_'+this.id).toggleClass('donation_sponsor_content_hidden');
	if ($(event.currentTarget).hasClass( "glyphicon-triangle-bottom" )) {
       $(event.currentTarget).removeClass( "glyphicon-triangle-bottom")
       $(event.currentTarget).addClass( "glyphicon-triangle-top")			
    }
    else if ($(event.currentTarget).hasClass( "glyphicon-triangle-top" )) {
       $(event.currentTarget).removeClass( "glyphicon-triangle-top")
       $(event.currentTarget).addClass( "glyphicon-triangle-bottom")		
    }
    grid.masonry();     
});
//============================= resize =============================//
$(window).resize(function() {
	$('.is-expanded').each(function()
	{
		id = $(this).attr('id')
		$("#doughnutChart_"+id).empty();
		$(".doughnutTip_"+id).remove();                
		$("#doughnutChart_"+id).drawDoughnutChart([
			{ title: "人事", value: parseInt($('#doughnutChart_'+id).attr('data-exp_personnel')),  color: "#02a0eb" },
			{ title: "雜支", value: parseInt($('#doughnutChart_'+id).attr('data-exp_business')),   color: "#c070a3" },
			{ title: "業務", value: parseInt($('#doughnutChart_'+id).attr('data-exp_mix')),   color: "#f4a301" },
			{ title: "其他", value: parseInt($('#doughnutChart_'+id).attr('data-exp_other')),   color: "#b3a253" }
		], {tipClass: "doughnutTip "+"doughnutTip_"+id});  					
	});
}); 

//============================= project login =============================//

$( "#login_form" ).submit(function( event ) {
  	event.preventDefault();
	if ($("#project_account").val().length < 1 || $("#project_password").val().length < 1) {
	    toastr['warning']('請輸入帳號密碼')	
	    return false;
	}

	$.ajax({
		type: "POST",
		url: "/projects/checkLogin",
		data: $(this).serializeArray(),
		dataType: 'json',
		success: function(data) {
			if (data.success) {
    		}else{
    		}
		}
	});
	return false;
});

/*
$("#login_form").bind("submit", function() {
	
		alert(132);
	
	if ($("#login_name").val().length < 1 || $("#login_pass").val().length < 1) {
	    $("#login_error").show();
	    return false;
	}
	
	alert(132);
	
	$.ajax({
		type		: "POST",
		cache	: false,
		url		: "/projects/check_login",
		data		: $(this).serializeArray(),
		dataType: 'json',
		success: function(data) {
			if (data.success) {
      			window.location.href = data.location;
    		}else{
    			window.location.href = data.location;
    			$.fancybox.hideLoading();
    		}
		}
	});

	return false;

});
*/
</script>
